(function(t){function e(e){for(var n,i,s=e[0],l=e[1],u=e[2],p=0,d=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&d.push(a[i][0]),a[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);c&&c(e);while(d.length)d.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],n=!0,s=1;s<r.length;s++){var l=r[s];0!==a[l]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=r[0]))}return t}var n={},a={app:0},o=[];function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var c=l;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";r("85ec")},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("Map",{staticClass:"map_videoclip",attrs:{layers:t.layers}}),r("Control",{staticClass:"control_videoclip",attrs:{dates:t.dates,tooltips:t.tooltips},on:{"update-time":t.UpdateMap}})],1)},o=[],i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container-fluid"},[r("div",{staticClass:"row justify-content-center test"},[r("div",{staticClass:"col-2 text-center align-self-center"},[r("button",{staticClass:"btn btn-success btn-play",on:{click:t.Action}},[t._v(" "+t._s(t.text)+" ")])]),r("div",{staticClass:"col"},[r("vue-slider",{attrs:{data:t.dates,marks:t.marks},on:{change:t.UpdateTime},model:{value:t.selectedIndex,callback:function(e){t.selectedIndex=e},expression:"selectedIndex"}})],1),r("div",{staticClass:"col-2"})])])},s=[],l=(r("159b"),r("99af"),{props:["dates","tooltips"],data:function(){return{value1:0,selectedIndex:0,min:0,max:8,text:"Play",play:!1,t:[],images:[{id:1,src:"..",alt:"Play"},{id:2,src:"",alt:"Pause"}]}},methods:{UpdateTime:function(){this.$emit("update-time",this.selectedIndex)},Play:function(){var t=this,e=1e3;this.text="Pause",this.selectedIndex=this.dates[0],this.UpdateTime();for(var r=function(r){t.t.push(setTimeout((function(){t.play&&(t.selectedIndex=t.dates[r],t.UpdateTime()),r==t.max-1&&(t.text="Play")}),(r+1)*e))},n=1;n<this.max;n++)r(n)},Pause:function(){this.t.forEach((function(t){clearTimeout(t)})),this.text="Play"},Action:function(){this.play=!this.play,this.play?this.Play():this.Pause()}},computed:{marks:function(){var t=this,e={};return this.dates.forEach((function(r,n){e[r]={label:"".concat(r," ").concat(t.tooltips[n].value),style:{width:"20px",height:"20px",display:"block",backgroundColor:t.tooltips[n].color,border:"2px solid white",transform:"translate(-8px, -8px)"},labelStyle:{backgroundColor:t.tooltips[n].color,"border-radius":"40px",border:"2px solid white","margin-top":"15px",padding:"10px",color:"white"}}})),e}}}),u=l,c=r("2877"),p=Object(c["a"])(u,i,s,!1,null,null,null),d=p.exports,f=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("vl-map",[r("vl-view",{attrs:{zoom:t.zoom,center:t.center,rotation:t.rotation},on:{"update:zoom":function(e){t.zoom=e},"update:center":function(e){t.center=e},"update:rotation":function(e){t.rotation=e}}}),r("vl-layer-tile",{attrs:{id:"osm"}},[r("vl-source-osm")],1),r("vl-layer-vector",t._l(t.layers,(function(t){return r("vl-feature",{key:t.id},[r("vl-geom-point",{attrs:{coordinates:t.coordinates,"matrix-set":"EPSG:3857"}}),r("vl-style-box",[r("vl-style-circle",{attrs:{radius:Number(t.radius)}},[r("vl-style-fill",{attrs:{color:t.fill}}),r("vl-style-stroke",{attrs:{color:t.stroke.color,width:Number(t.stroke.width)}})],1),r("vl-style-text",{attrs:{text:t.value+"",font:"14px sans-serif"}},[r("vl-style-fill",{attrs:{color:"white"}})],1)],1)],1)})),1)],1)},h=[],v={props:["layers"],data:function(){return{zoom:11,center:[10326243.3178926,7555742.7863465175],rotation:0}}},m=v,b=Object(c["a"])(m,f,h,!1,null,null,null),g=b.exports,y=r("1da1"),x=(r("96cf"),r("4de4"),r("d81d"),r("b680"),r("a9e3"),r("d3b7"),r("1276"),r("ac1f"),r("a79f"));x["a"].defs("EPSG:3857"),x["a"].defs("EPSG:4326");var w=[0,12,35,70,150,200,250,1e3],P=["rgb(0,153,102)","rgb(255,222,51)","rgb(255,153,51)","rgb(204,0,51)","rgb(102,0,153)","rgb(126,0,35)","rgb(0,0,0)"];function k(t){return _.apply(this,arguments)}function _(){return _=Object(y["a"])(regeneratorRuntime.mark((function t(e){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://gis.krasn.ru/sc/api/1.0/projects/9/aggvalues?&key=654hblgm9gl8367h&time_begin=".concat(e[0]," 00:00:00&time_end=").concat(e[e.length-1]," 00:00:00&time_interval=1day&indicators=348&limit=30000'"),n=fetch(r),a=n.then((function(t){return O(t)})),t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)}))),_.apply(this,arguments)}function O(t){return j.apply(this,arguments)}function j(){return j=Object(y["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.text().then((function(t){var e=[],r=new DOMParser,n=r.parseFromString(t,"text/xml"),a=n.getElementsByTagName("aggvalue");return a.forEach((function(t){var r=t.getAttribute("indicator"),n=t.getAttribute("time").substring(0,t.getAttribute("time").length-3).split(" ")[0],a=Number(t.getElementsByTagName("avg")[0].innerHTML).toFixed(4),o=t.getAttribute("site"),i=t.getElementsByTagName("location")[0],s=i.getAttribute("x"),l=i.getAttribute("y");e.push({site:o,indicator:r,time:n,value:a,coordinates:Object(x["a"])("EPSG:4326","EPSG:3857",[Number(s),Number(l)])})})),e})),t.abrupt("return",r);case 2:case"end":return t.stop()}}),t)}))),j.apply(this,arguments)}function E(){return T.apply(this,arguments)}function T(){return T=Object(y["a"])(regeneratorRuntime.mark((function t(){var e,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=new Date,r=new Date,n=[],r.setDate(r.getDate()-7);while(r.getTime()<=e.getTime())n.push(S(r)),r.setDate(r.getDate()+1);return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)}))),T.apply(this,arguments)}function S(t){var e=t.getDate();e<10&&(e="0"+e);var r=t.getMonth()+1;r<10&&(r="0"+r);var n=t.getFullYear();return n<10&&(n="0"+n),n+"-"+r+"-"+e}function C(t,e){var r=t.filter((function(t){if(t.time==e)return t}));return r}function D(t){var e=t.map((function(t){for(var e=(1e3*t.value).toFixed(0),r=1;r<w.length;r++)if(e>=w[r-1]&&e<w[r])return{id:t.site,fill:P[r-1],radius:25,value:e,stroke:{color:"white",width:2},zindex:10,coordinates:t.coordinates}}));return e}function M(t,e){var r=e.map((function(e){var r=C(t,e),n=r.length,a=0;return r.forEach((function(t){a+=Number(t.value)})),(a/n*1e3).toFixed(2)})),n=r.map((function(t){for(var e=0;e<P.length;e++)if(t>=w[e-1]&&t<w[e])return{color:P[e-1],value:t}}));return n}var A={name:"App",data:function(){return{receivedData:[],layers:[],tooltips:[],dates:[]}},components:{Map:g,Control:d},mounted:function(){var t=this;E().then((function(e){k(e).then((function(r){t.dates=e,t.receivedData=r,t.tooltips=M(r,e);var n=C(r,e[0]);t.layers=D(n),t.load=!0}))}))},methods:{UpdateMap:function(t){var e=C(this.receivedData,t);this.layers=D(e)}}},N=A,I=(r("034f"),Object(c["a"])(N,a,o,!1,null,null,null)),z=I.exports,R=r("1cf8"),U=(r("4989"),r("f9e3"),r("2b69"),r("4971")),F=r.n(U);r("24df");n["default"].component("VueSlider",F.a),n["default"].config.productionTip=!1,n["default"].use(R["a"]),new n["default"]({render:function(t){return t(z)}}).$mount("#app")},"85ec":function(t,e,r){}});
//# sourceMappingURL=app.b7225e28.js.map