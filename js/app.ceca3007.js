(function(t){function e(e){for(var i,o,s=e[0],c=e[1],l=e[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(p.length)p.shift()();return n.push.apply(n,l||[]),r()}function r(){for(var t,e=0;e<n.length;e++){for(var r=n[e],i=!0,s=1;s<r.length;s++){var c=r[s];0!==a[c]&&(i=!1)}i&&(n.splice(e--,1),t=o(o.s=r[0]))}return t}var i={},a={app:0},n=[];function o(e){if(i[e])return i[e].exports;var r=i[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=i,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(r,i,function(e){return t[e]}.bind(null,i));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="./";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;n.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";r("85ec")},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var i=r("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("Map",{staticClass:"map_videoclip",attrs:{layers:t.layers}}),i("Control",{staticClass:"control_videoclip",attrs:{dates:t.dates,wind:t.receivedWind,tooltips:t.tooltips},on:{"update-time":t.UpdateMap,"update-indicator":t.UpdateIndicator}}),i("transition",{attrs:{name:"arrow"}},[1==t.show?i("img",{staticClass:"arrow",attrs:{src:r("ec55"),width:"74px",height:"74px"}}):t._e()])],1)},n=[],o=r("2909"),s=(r("d81d"),r("a9e3"),r("b680"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mark_videoclip_container"},[i("div",{staticClass:"mark_videoclip_play"},[i("button",{staticClass:"btn-play",on:{click:t.Action}},[0==t.play?i("img",{attrs:{src:r("5830"),width:"74px",height:"74px"}}):i("img",{attrs:{src:r("ec7e"),width:"74px",height:"74px"}})])]),i("div",{staticClass:"mark_videoclip_tooltips"},[i("ul",{staticClass:"ul_videoclip p-0 m-0"},t._l(t.tooltips,(function(e,r){return i("li",{key:r,on:{click:function(e){return t.Active(r)}}},[i("div",{staticClass:"card mark_videoclip_tooltip",class:{mark_videoclip_tooltip_active:r==t.activeElement},style:{background:e.color,color:e.text}},[i("div",{staticClass:"card-header mark_videoclip_tooltip_header p-0 m-0 text-center",style:{background:t.LightenDarkenColor(-.3,e.color),color:e.text}},[i("span",[t._v(t._s(t.Formater(t.dates[r])))])]),i("div",{staticClass:"card-body p-0 m-0 ml-0"},[i("div",{staticClass:"info_videoclip_container"},[i("ul",{staticClass:"ul_info_videoclip text-center"},[i("li",[i("span",{staticClass:"mark_videoclip_text_PM"},[t._v(t._s(e.value))])])]),i("ul",{staticClass:"ul_info_videoclip_wind"},[i("li",[i("span",[t._v(t._s(e.valueT)+"°C")])]),i("li",[i("span",[t._v(t._s(t.wind.windDir[r])+",")]),i("span",{staticClass:"ml-2"},[t._v(t._s(t.wind.windSpeed[r])+" ")]),t._m(0,!0)])])])])])])})),0)]),i("div",{staticClass:"mark_videoclip_pause"},[i("Modal",{on:{"update-indicator":t.UpdateIndicator}})],1)])}),c=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"frac"},[r("sup",[t._v("м")]),r("sub",[t._v("с")])])}],l=r("3835"),u=(r("159b"),r("1276"),r("ac1f"),r("fb6a"),r("d3b7"),r("25f0"),r("1da1")),d=(r("96cf"),r("4de4"),r("99af"),r("a79f"));d["a"].defs("EPSG:3857"),d["a"].defs("EPSG:4326");var p=[0,12,35.4,55.4,150,200,250,1e3],f=[0,50,100,150,200,300,500,1e3],v=[0,1,10],m={PM:348,AQI:355,PDK:400,TEMP:103,DIR:101,SPEED:102},h={PM:p,AQI:f,PDK:v},g={PM:1e3,AQI:1,PDK:1,TEMP:1},b=[{color:"rgb(0,153,102)",text:"rgb(250,250,250)"},{color:"rgb(255,222,51)",text:"rgb(0,0,0)"},{color:"rgb(255,153,51)",text:"rgb(250,250,250)"},{color:"rgb(204,0,51)",text:"rgb(250,250,250)"},{color:"rgb(102,0,153)",text:"rgb(250,250,250)"},{color:"rgb(126,0,35)",text:"rgb(250,250,250)"},{color:"rgb(0,0,0)",text:"rgb(250,250,250)"}],_=[{color:"rgb(0,153,102)",text:"rgb(250,250,250)"},{color:"rgb(255,222,51)",text:"rgb(0,0,0)"},{color:"rgb(255,153,51)",text:"rgb(250,250,250)"},{color:"rgb(204,0,51)",text:"rgb(250,250,250)"},{color:"rgb(102,0,153)",text:"rgb(250,250,250)"},{color:"rgb(126,0,35)",text:"rgb(250,250,250)"},{color:"rgb(0,0,0)",text:"rgb(250,250,250)"}],y=[{color:"rgb(0,153,102)",text:"rgb(250,250,250)"},{color:"rgb(204,0,51)",text:"rgb(250,250,250)"}],x={PM:b,AQI:_,PDK:y};function w(t){return C.apply(this,arguments)}function C(){return C=Object(u["a"])(regeneratorRuntime.mark((function t(e){var r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://gis.krasn.ru/sc/api/1.0/projects/9/aggvalues?&key=654hblgm9gl8367h&time_begin=".concat(e[0]," 00:00:00&time_end=").concat(e[e.length-1]," 00:00:00&time_interval=1day&indicators=348,355,103&limit=30000'"),i=fetch(r),a=i.then((function(t){return D(t)})),t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)}))),C.apply(this,arguments)}function P(t){return k.apply(this,arguments)}function k(){return k=Object(u["a"])(regeneratorRuntime.mark((function t(e){var r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://gis.krasn.ru/sc/api/1.0/projects/6/aggvalues?&key=654hblgm9gl8367h&sites=4203&time_begin=".concat(e[0]," 00:00:00&time_end=").concat(e[e.length-1]," 00:00:00&time_interval=1day&indicators=101,102&limit=30000'"),i=fetch(r),a=i.then((function(t){return D(t)})),t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)}))),k.apply(this,arguments)}function D(t){return M.apply(this,arguments)}function M(){return M=Object(u["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.text().then((function(t){var e=[],r=new DOMParser,i=r.parseFromString(t,"text/xml"),a=i.getElementsByTagName("aggvalue");return a.forEach((function(t){var r=t.getAttribute("indicator"),i=t.getAttribute("time").substring(0,t.getAttribute("time").length-3).split(" ")[0],a=Number(t.getElementsByTagName("avg")[0].innerHTML).toFixed(6),n=t.getAttribute("site"),o=t.getElementsByTagName("location")[0];if(o){var s=o.getAttribute("x"),c=o.getAttribute("y");e.push({site:n,indicator:r,time:i,value:a,coordinates:Object(d["a"])("EPSG:4326","EPSG:3857",[Number(s),Number(c)])})}})),e})),t.abrupt("return",r);case 2:case"end":return t.stop()}}),t)}))),M.apply(this,arguments)}function I(){return E.apply(this,arguments)}function E(){return E=Object(u["a"])(regeneratorRuntime.mark((function t(){var e,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=new Date,r=new Date,i=[],r.setDate(r.getDate()-7);while(r.getTime()<e.getTime())i.push(A(r)),r.setDate(r.getDate()+1);return t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)}))),E.apply(this,arguments)}function A(t){var e=t.getDate();e<10&&(e="0"+e);var r=t.getMonth()+1;r<10&&(r="0"+r);var i=t.getFullYear();return i<10&&(i="0"+i),i+"-"+r+"-"+e}function S(t){if(void 0!=t){var e=t.split(" ")[0].split("-"),r=new Date(e[0],e[1]-1,e[2],0,0,0).toLocaleString("ru",{month:"short",day:"numeric",weekday:"short"});return r}return(new Date).toLocaleString("ru",{month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric"})}function O(t,e,r){var i=m[r],a=t.filter((function(t){if(t.time==e&&t.indicator==i)return t}));return a}function T(t,e){var r=m[e],i=t.filter((function(t){if(t.indicator==r)return t}));return i}function j(t,e){var r=t.map((function(t){var r=0;"PM"!=e&&"AQI"!=e||(r=(t.value*g[e]).toFixed(0)),"PDK"==e&&(r=(t.value*g[e]).toFixed(2));for(var i=1;i<h[e].length;i++)if(Number(r)>=h[e][i-1]&&Number(r)<h[e][i])return{id:t.site,fill:x[e][i-1].color,radius:27,value:r,text:x[e][i-1].text,font:"20px sans-serif",stroke:{color:"white",width:2},zindex:10,coordinates:t.coordinates}}));return r}function N(t){var e=35,r=t.map((function(t){var r=1e3*t.value,i=(r/e).toFixed(2);return{site:t.site,indicator:"400",time:t.time,value:i,coordinates:t.coordinates}}));return r}function $(t,e,r){var i=e.map((function(e){var i=O(t,e,r),a=O(t,e,"TEMP"),n=R(i,r),o=R(a,"TEMP");return{AVG:n,AVGT:o}})),a=i.map((function(t){for(var e=0;e<h[r].length;e++)if(Number(t.AVG)>=h[r][e-1]&&Number(t.AVG)<h[r][e])return{color:x[r][e-1].color,text:x[r][e-1].text,value:t.AVG,valueT:t.AVGT}}));return a}function R(t,e){var r=0,i=t.length;return t.forEach((function(t){r+=Number(t.value)})),"PM"==e||"AQI"==e||"TEMP"==e?(r/i*g[e]).toFixed(0):"PDK"==e?(r/i*g[e]).toFixed(2):void 0}function B(t){return t>=0&&t<11.25?"С":t>=11.25&&t<33.75?"ССВ":t>=33.75&&t<56.25?"СВ":t>=56.25&&t<78.75?"ВСВ":t>=78.75&&t<101.25?"В":t>=101.25&&t<123.75?"ВЮВ":t>=123.75&&t<146.25?"ЮВ":t>=146.25&&t<168.75?"ЮЮВ":t>=168.75&&t<191.25?"Ю":t>=191.25&&t<213.75?"ЮЮЗ":t>=213.75&&t<236.25?"ЮЗ":t>=236.25&&t<258.75?"ЗЮЗ":t>=258.75&&t<281.25?"З":t>=281.25&&t<303.75?"ЗСЗ":t>=303.75&&t<326.25?"СЗ":t>=326.25&&t<348.75?"ССЗ":t>=348.75?"С":void 0}var F=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._m(0),r("div",{staticClass:"modal fade",attrs:{id:"staticBackdrop","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"}},[r("div",{staticClass:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},[r("div",{staticClass:"modal-content"},[t._m(1),r("div",{staticClass:"modal-body"},[r("div",{staticClass:"row"},t._l(t.indicators,(function(e){return r("div",{key:e.id,staticClass:"col"},[r("button",{staticClass:"btn btn-warning btn-lg",attrs:{"data-dismiss":"modal"},on:{click:function(r){return t.SelectIndicator(e.type)},mouseover:function(r){t.selectedDiscription=e.description}}},[t._v(" "+t._s(e.name)+" ")])])})),0),r("div",{staticClass:"row"},[r("div",{staticClass:"col pt-2"},[t._v(t._s(t.selectedDiscription))])])]),r("div",{staticClass:"modal-footer"},[r("div",{staticClass:"row full"},[r("div",{staticClass:"col"},[r("div",{staticClass:"form-check"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.save,expression:"save"}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"RememberSelection"},domProps:{checked:Array.isArray(t.save)?t._i(t.save,null)>-1:t.save},on:{change:function(e){var r=t.save,i=e.target,a=!!i.checked;if(Array.isArray(r)){var n=null,o=t._i(r,n);i.checked?o<0&&(t.save=r.concat([n])):o>-1&&(t.save=r.slice(0,o).concat(r.slice(o+1)))}else t.save=a}}}),r("label",{staticClass:"form-check-label font-weight-bold",attrs:{for:"RememberSelection"}},[t._v("Запомнить выбор")])])]),t._m(2)])])])])])])},U=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"btn-play",attrs:{type:"button","data-toggle":"modal","data-target":"#staticBackdrop"}},[i("img",{attrs:{src:r("66e6"),width:"74px",height:"74px"}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal-header p-0 m-0 modal_videoclip_header"},[r("h5",{staticClass:"modal-title p-2",attrs:{id:"staticBackdropLabel"}},[t._v(" Выбор единиц измерения ")]),r("button",{staticClass:"modal_videoclip_close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[r("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"col"},[r("button",{staticClass:"modal_videoclip_button p-1",attrs:{type:"button","data-dismiss":"modal"}},[t._v(" Закрыть ")])])}],G=(r("a4d3"),r("e01a"),r("7db0"),r("1157")),K=r.n(G),L={data:function(){return{save:!1,selectedDiscription:null,indicators:[{id:0,name:"PM2.5",type:"PM",description:"Концентрация пыли в мкг/м3"},{id:1,name:"AQI",type:"AQI",description:"Индекс качества воздуха AQI"},{id:2,name:"ПДК",type:"PDK",description:"Доля среднесуточного ПДК (35 мкг/м3)"}]}},mounted:function(){var t=localStorage.getItem("KNC_VIDEOCLIP_INDICATOR");if(t){var e=this.indicators.find((function(e){return e.type==t}));this.selectedDiscription=e.description}else K()("#staticBackdrop").modal("show"),this.selectedDiscription=this.indicators[0].description},methods:{SelectIndicator:function(t){1==this.save&&localStorage.setItem("KNC_VIDEOCLIP_INDICATOR",t),this.$emit("update-indicator",t)}}},V=L,Q=r("2877"),z=Object(Q["a"])(V,F,U,!1,null,null,null),W=z.exports,J={components:{Modal:W},props:["dates","tooltips","wind"],data:function(){return{selectedIndex:0,min:0,max:7,text:"Play",play:!1,t:[],activeElement:0}},methods:{UpdateTime:function(){this.$emit("update-time",this.selectedIndex)},UpdateIndicator:function(t){this.Pause(),this.$emit("update-indicator",t)},Play:function(){var t=this,e=2e3;this.text="Pause",this.selectedIndex=this.dates[0],this.activeElement=0,this.UpdateTime();for(var r=function(r){t.t.push(setTimeout((function(){t.play&&(t.activeElement=r,t.selectedIndex=t.dates[r],t.UpdateTime()),r==t.max-1&&t.Pause()}),r*e))},i=1;i<this.max;i++)r(i)},Pause:function(){this.play=!1,this.t.forEach((function(t){clearTimeout(t)})),this.text="Play"},Action:function(){this.play=!this.play,this.play?this.Play():this.Pause()},Formater:function(t){return S(t)},LightenDarkenColor:function(t,e,r,i){var a,n,o,s,c,u,d,p=parseInt,f=Math.round,v="string"==typeof r;return"number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||r&&!v?null:(this.pSBCr||(this.pSBCr=function(t){var e=t.length,r={};if(e>9){var i,s;if(i=t=t.split(","),s=Object(l["a"])(i,4),a=s[0],n=s[1],o=s[2],v=s[3],e=t.length,e<3||e>4)return null;r.r=p("a"==a[3]?a.slice(5):a.slice(4)),r.g=p(n),r.b=p(o),r.a=v?parseFloat(v):-1}else{if(8==e||6==e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=p(t.slice(1),16),9==e||5==e?(r.r=t>>24&255,r.g=t>>16&255,r.b=t>>8&255,r.a=f((255&t)/.255)/1e3):(r.r=t>>16,r.g=t>>8&255,r.b=255&t,r.a=-1)}return r}),d=e.length>9,d=v?r.length>9||"c"==r&&!d:d,c=this.pSBCr(e),s=t<0,u=r&&"c"!=r?this.pSBCr(r):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},t=s?-1*t:t,s=1-t,c&&u?(i?(a=f(s*c.r+t*u.r),n=f(s*c.g+t*u.g),o=f(s*c.b+t*u.b)):(a=f(Math.pow(s*Math.pow(c.r,2)+t*Math.pow(u.r,2),.5)),n=f(Math.pow(s*Math.pow(c.g,2)+t*Math.pow(u.g,2),.5)),o=f(Math.pow(s*Math.pow(c.b,2)+t*Math.pow(u.b,2),.5))),v=c.a,u=u.a,c=v>=0||u>=0,v=c?v<0?u:u<0?v:v*s+u*t:0,d?"rgb"+(c?"a(":"(")+a+","+n+","+o+(c?","+f(1e3*v)/1e3:"")+")":"#"+(4294967296+16777216*a+65536*n+256*o+(c?f(255*v):0)).toString(16).slice(1,c?void 0:-2)):null)},Active:function(t){this.selectedIndex=this.dates[t],this.activeElement=t,this.Pause(),this.UpdateTime()}},computed:{marks:function(){var t=this,e={};return this.dates.forEach((function(r,i){e[r]={label:"".concat(t.tooltips[i].value),labelStyle:{visibility:"hidden"}}})),e}}},H=J,Y=Object(Q["a"])(H,s,c,!1,null,null,null),q=Y.exports,X=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("vl-map",{ref:"map",attrs:{controls:!1},on:{update:t.UpdateMap}},[r("vl-view",{attrs:{zoom:t.zoom,center:t.center}}),r("vl-layer-tile",{attrs:{id:"osm"}},[r("vl-source-osm")],1),t._l(t.layers,(function(e){return r("vl-feature",{key:e.id,attrs:{id:e.id}},[r("vl-geom-point",{attrs:{coordinates:e.coordinates},on:{"update:coordinates":function(r){return t.$set(e,"coordinates",r)}}}),r("vl-style-box",[r("vl-style-circle",{attrs:{radius:Number(e.radius)}},[r("vl-style-fill",{attrs:{color:e.fill},on:{"update:color":function(r){return t.$set(e,"fill",r)}}}),r("vl-style-stroke",{attrs:{color:e.stroke.color,width:Number(e.stroke.width)},on:{"update:color":function(r){return t.$set(e.stroke,"color",r)}}})],1),r("vl-style-text",{attrs:{text:e.value+"",font:e.font}},[r("vl-style-fill",{attrs:{color:e.text},on:{"update:color":function(r){return t.$set(e,"text",r)}}})],1)],1)],1)}))],2)},Z=[],tt={props:["layers"],data:function(){return{show:!0,zoom:11,center:[10326243.3178926,7555742.7863465175],rotation:0}},methods:{UpdateMap:function(){console.log(1)}}},et=tt,rt=Object(Q["a"])(et,X,Z,!1,null,null,null),it=rt.exports,at={name:"App",data:function(){return{receivedData:[],receivedWind:[],layers:[],tooltips:[],dates:[],indicator:"PM",time:"",show:!0}},components:{Map:it,Control:q},mounted:function(){var t=this;I().then((function(e){w(e).then((function(r){var i=T(r,"PM"),a=N(i);r.push.apply(r,Object(o["a"])(a));var n=localStorage.getItem("KNC_VIDEOCLIP_INDICATOR");n&&(t.show=!1,t.indicator=n),t.dates=e,t.receivedData=r,t.time=e[0],t.tooltips=$(r,e,t.indicator);var s=O(r,e[0],t.indicator);t.layers=j(s,t.indicator)})),P(e).then((function(e){var r=T(e,"DIR").map((function(t){return B(t.value)})),i=T(e,"SPEED").map((function(t){var e=Number(t.value);return e.toFixed(0)}));t.receivedWind={windDir:r,windSpeed:i}}))}))},methods:{UpdateMap:function(t){this.time=t;var e=O(this.receivedData,t,this.indicator);this.layers=j(e,this.indicator)},UpdateIndicator:function(t){this.show=!1,this.indicator=t;var e=O(this.receivedData,this.time,this.indicator);this.tooltips=$(this.receivedData,this.dates,t),this.layers=j(e,t)}}},nt=at,ot=(r("034f"),Object(Q["a"])(nt,a,n,!1,null,null,null)),st=ot.exports,ct=r("1cf8"),lt=(r("4989"),r("f9e3"),r("2b69"),r("4971")),ut=r.n(lt);r("24df");i["default"].component("VueSlider",ut.a),i["default"].config.productionTip=!1,i["default"].use(ct["a"]),new i["default"]({render:function(t){return t(st)}}).$mount("#app")},5830:function(t,e,r){t.exports=r.p+"img/play.993f667f.svg"},"66e6":function(t,e,r){t.exports=r.p+"img/wheel.a8d5cb2f.svg"},"85ec":function(t,e,r){},ec55:function(t,e,r){t.exports=r.p+"img/arrow-up.d851613e.svg"},ec7e:function(t,e,r){t.exports=r.p+"img/pause.c5b91dcd.svg"}});
//# sourceMappingURL=app.ceca3007.js.map