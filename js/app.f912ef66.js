(function(t){function e(e){for(var a,i,s=e[0],c=e[1],l=e[2],d=0,p=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&p.push(n[i][0]),n[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(p.length)p.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],a=!0,s=1;s<r.length;s++){var c=r[s];0!==n[c]&&(a=!1)}a&&(o.splice(e--,1),t=i(i.s=r[0]))}return t}var a={},n={app:0},o=[];function i(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=a,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(r,a,function(e){return t[e]}.bind(null,a));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";r("85ec")},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("Map",{staticClass:"map_videoclip",attrs:{layers:t.layers}}),a("Control",{staticClass:"control_videoclip",attrs:{dates:t.dates,tooltips:t.tooltips},on:{"update-time":t.UpdateMap,"update-indicator":t.UpdateIndicator}}),a("transition",{attrs:{name:"arrow"}},[1==t.show?a("img",{staticClass:"arrow",attrs:{src:r("ec55"),width:"74px",height:"74px"}}):t._e()])],1)},o=[],i=r("2909"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid"},[a("div",{staticClass:"row justify-content-center full"},[a("div",{staticClass:"col-2 text-center align-self-center"},[a("button",{staticClass:"btn-play",on:{click:t.Action}},[0==t.play?a("img",{attrs:{src:r("5830"),width:"74px",height:"74px"}}):a("img",{attrs:{src:r("ec7e"),width:"74px",height:"74px"}})])]),a("div",{staticClass:"col mt-5"},[a("vue-slider",{attrs:{data:t.dates,order:!1,tooltip:"none",marks:t.marks},on:{change:t.UpdateTime},scopedSlots:t._u([{key:"step",fn:function(e){var r=e.value,n=e.label;return[a("div",{staticClass:"mark_videoclip",style:{background:t.tooltips[t.tooltips.findIndex((function(t){return t.value==n}))].color,color:t.tooltips[t.tooltips.findIndex((function(t){return t.value==n}))].text}},[t._v(" "+t._s(t.Formater(r))+" ")]),a("div",{staticClass:"mark_videoclip_dot",style:{background:t.tooltips[t.tooltips.findIndex((function(t){return t.value==n}))].color}})]}}]),model:{value:t.selectedIndex,callback:function(e){t.selectedIndex=e},expression:"selectedIndex"}})],1),a("div",{staticClass:"col-2 text-center align-self-center"},[a("Modal",{on:{"update-indicator":t.UpdateIndicator}})],1)])])},c=[],l=(r("159b"),r("1da1")),u=(r("96cf"),r("1276"),r("ac1f"),r("4de4"),r("d81d"),r("b680"),r("a9e3"),r("99af"),r("d3b7"),r("a79f"));u["a"].defs("EPSG:3857"),u["a"].defs("EPSG:4326");var d=[0,12,35.4,55.4,150,200,250,1e3],p=[0,50,100,150,200,300,500,1e3],f=[0,1,10],m={PM:348,AQI:355,PDK:400},v={PM:d,AQI:p,PDK:f},h={PM:1e3,AQI:1,PDK:1},g=[{color:"rgb(0,153,102)",text:"rgb(250,250,250)"},{color:"rgb(255,222,51)",text:"rgb(0,0,0)"},{color:"rgb(255,153,51)",text:"rgb(250,250,250)"},{color:"rgb(204,0,51)",text:"rgb(250,250,250)"},{color:"rgb(102,0,153)",text:"rgb(250,250,250)"},{color:"rgb(126,0,35)",text:"rgb(250,250,250)"},{color:"rgb(0,0,0)",text:"rgb(250,250,250)"}],b=[{color:"rgb(0,153,102)",text:"rgb(250,250,250)"},{color:"rgb(255,222,51)",text:"rgb(0,0,0)"},{color:"rgb(255,153,51)",text:"rgb(250,250,250)"},{color:"rgb(204,0,51)",text:"rgb(250,250,250)"},{color:"rgb(102,0,153)",text:"rgb(250,250,250)"},{color:"rgb(126,0,35)",text:"rgb(250,250,250)"},{color:"rgb(0,0,0)",text:"rgb(250,250,250)"}],x=[{color:"rgb(0,153,102)",text:"rgb(250,250,250)"},{color:"rgb(204,0,51)",text:"rgb(250,250,250)"}],y={PM:g,AQI:b,PDK:x};function w(t){return _.apply(this,arguments)}function _(){return _=Object(l["a"])(regeneratorRuntime.mark((function t(e){var r,a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://gis.krasn.ru/sc/api/1.0/projects/9/aggvalues?&key=654hblgm9gl8367h&time_begin=".concat(e[0]," 00:00:00&time_end=").concat(e[e.length-1]," 00:00:00&time_interval=1day&indicators=348,355&limit=30000'"),a=fetch(r),n=a.then((function(t){return C(t)})),t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)}))),_.apply(this,arguments)}function C(t){return k.apply(this,arguments)}function k(){return k=Object(l["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.text().then((function(t){var e=[],r=new DOMParser,a=r.parseFromString(t,"text/xml"),n=a.getElementsByTagName("aggvalue");return n.forEach((function(t){var r=t.getAttribute("indicator"),a=t.getAttribute("time").substring(0,t.getAttribute("time").length-3).split(" ")[0],n=Number(t.getElementsByTagName("avg")[0].innerHTML).toFixed(4),o=t.getAttribute("site"),i=t.getElementsByTagName("location")[0],s=i.getAttribute("x"),c=i.getAttribute("y");e.push({site:o,indicator:r,time:a,value:n,coordinates:Object(u["a"])("EPSG:4326","EPSG:3857",[Number(s),Number(c)])})})),e})),t.abrupt("return",r);case 2:case"end":return t.stop()}}),t)}))),k.apply(this,arguments)}function I(){return P.apply(this,arguments)}function P(){return P=Object(l["a"])(regeneratorRuntime.mark((function t(){var e,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=new Date,r=new Date,a=[],r.setDate(r.getDate()-7);while(r.getTime()<e.getTime())a.push(O(r)),r.setDate(r.getDate()+1);return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)}))),P.apply(this,arguments)}function O(t){var e=t.getDate();e<10&&(e="0"+e);var r=t.getMonth()+1;r<10&&(r="0"+r);var a=t.getFullYear();return a<10&&(a="0"+a),a+"-"+r+"-"+e}function D(t){if(void 0!=t){var e=t.split(" ")[0].split("-"),r=new Date(e[0],e[1]-1,e[2],0,0,0).toLocaleString("ru",{month:"short",day:"numeric",weekday:"short"});return r}return(new Date).toLocaleString("ru",{month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric"})}function M(t,e,r){var a=m[r],n=t.filter((function(t){if(t.time==e&&t.indicator==a)return t}));return n}function A(t,e){var r=m[e],a=t.filter((function(t){if(t.indicator==r)return t}));return a}function S(t,e){var r=t.map((function(t){for(var r=(t.value*h[e]).toFixed(1),a=1;a<v[e].length;a++)if(Number(r)>=v[e][a-1]&&Number(r)<v[e][a])return{id:t.site,fill:y[e][a-1].color,radius:25,value:r,text:y[e][a-1].text,stroke:{color:"white",width:2},zindex:10,coordinates:t.coordinates}}));return r}function E(t){var e=35,r=t.map((function(t){var r=1e3*t.value,a=(r/e).toFixed(2);return{site:t.site,indicator:"400",time:t.time,value:a,coordinates:t.coordinates}}));return r}function j(t,e,r){var a=e.map((function(e){var a=M(t,e,r),n=a.length,o=0;return a.forEach((function(t){o+=Number(t.value)})),(o/n*h[r]).toFixed(1)})),n=a.map((function(t){for(var e=0;e<v[r].length;e++)if(Number(t)>=v[r][e-1]&&Number(t)<v[r][e])return{color:y[r][e-1].color,text:y[r][e-1].text,value:t}}));return n}var N=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._m(0),r("div",{staticClass:"modal fade",attrs:{id:"staticBackdrop","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"}},[r("div",{staticClass:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},[r("div",{staticClass:"modal-content"},[t._m(1),r("div",{staticClass:"modal-body"},[r("div",{staticClass:"row"},t._l(t.indicators,(function(e){return r("div",{key:e.id,staticClass:"col"},[r("button",{staticClass:"btn btn-warning btn-lg",attrs:{"data-dismiss":"modal"},on:{click:function(r){return t.SelectIndicator(e.type)}}},[t._v(" "+t._s(e.name)+" ")])])})),0)]),r("div",{staticClass:"modal-footer"},[r("div",{staticClass:"row full"},[r("div",{staticClass:"col"},[r("div",{staticClass:"form-check"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.save,expression:"save"}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"RememberSelection"},domProps:{checked:Array.isArray(t.save)?t._i(t.save,null)>-1:t.save},on:{change:function(e){var r=t.save,a=e.target,n=!!a.checked;if(Array.isArray(r)){var o=null,i=t._i(r,o);a.checked?i<0&&(t.save=r.concat([o])):i>-1&&(t.save=r.slice(0,i).concat(r.slice(i+1)))}else t.save=n}}}),r("label",{staticClass:"form-check-label font-weight-bold",attrs:{for:"RememberSelection"}},[t._v("Запомнить выбор")])])]),t._m(2)])])])])])])},T=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"btn-play",attrs:{type:"button","data-toggle":"modal","data-target":"#staticBackdrop"}},[a("img",{attrs:{src:r("66e6"),width:"74px",height:"74px"}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal-header"},[r("h5",{staticClass:"modal-title",attrs:{id:"staticBackdropLabel"}},[t._v(" Выборите показатель ")]),r("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[r("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"col"},[r("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v(" Закрыть ")])])}],$=r("1157"),U=r.n($),R={data:function(){return{save:!1,indicators:[{id:0,name:"PM2.5",type:"PM"},{id:1,name:"AQI",type:"AQI"},{id:2,name:"ПДК",type:"PDK"}]}},mounted:function(){var t=localStorage.getItem("KNC_VIDEOCLIP_INDICATOR");t||U()("#staticBackdrop").modal("show")},methods:{SelectIndicator:function(t){1==this.save&&localStorage.setItem("KNC_VIDEOCLIP_INDICATOR",t),this.$emit("update-indicator",t)}}},B=R,F=r("2877"),K=Object(F["a"])(B,N,T,!1,null,null,null),L=K.exports,Q={components:{Modal:L},props:["dates","tooltips"],data:function(){return{selectedIndex:0,min:0,max:7,text:"Play",play:!1,t:[]}},methods:{UpdateTime:function(){this.$emit("update-time",this.selectedIndex)},UpdateIndicator:function(t){this.$emit("update-indicator",t)},Play:function(){var t=this,e=2e3;this.text="Pause",this.selectedIndex=this.dates[0],this.UpdateTime();for(var r=function(r){t.t.push(setTimeout((function(){t.play&&(t.selectedIndex=t.dates[r],t.UpdateTime()),r==t.max-1&&t.Pause()}),r*e))},a=1;a<this.max;a++)r(a)},Pause:function(){this.play=!1,this.t.forEach((function(t){clearTimeout(t)})),this.text="Play"},Action:function(){this.play=!this.play,this.play?this.Play():this.Pause()},Formater:function(t){return D(t)}},computed:{marks:function(){var t=this,e={};return this.dates.forEach((function(r,a){e[r]={label:"".concat(t.tooltips[a].value),labelStyle:{backgroundColor:t.tooltips[a].color,"border-radius":"40px",border:"2px solid white","margin-top":"15px",padding:"10px",color:t.tooltips[a].text,"font-size":"20px","font-weight":"bold"}}})),e}}},z=Q,G=Object(F["a"])(z,s,c,!1,null,null,null),V=G.exports,J=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("vl-map",{ref:"map",attrs:{controls:!1},on:{update:t.UpdateMap}},[r("vl-view",{attrs:{zoom:t.zoom,center:t.center}}),r("vl-layer-tile",{attrs:{id:"osm"}},[r("vl-source-osm")],1),t._l(t.layers,(function(e){return r("vl-feature",{key:e.id,attrs:{id:e.id}},[r("vl-geom-point",{attrs:{coordinates:e.coordinates},on:{"update:coordinates":function(r){return t.$set(e,"coordinates",r)}}}),r("vl-style-box",[r("vl-style-circle",{attrs:{radius:Number(e.radius)}},[r("vl-style-fill",{attrs:{color:e.fill},on:{"update:color":function(r){return t.$set(e,"fill",r)}}}),r("vl-style-stroke",{attrs:{color:e.stroke.color,width:Number(e.stroke.width)},on:{"update:color":function(r){return t.$set(e.stroke,"color",r)}}})],1),r("vl-style-text",{attrs:{text:e.value+"",font:"14px sans-serif"}},[r("vl-style-fill",{attrs:{color:e.text},on:{"update:color":function(r){return t.$set(e,"text",r)}}})],1)],1)],1)}))],2)},H=[],Y={props:["layers"],data:function(){return{show:!0,zoom:11,center:[10326243.3178926,7555742.7863465175],rotation:0}},methods:{UpdateMap:function(){console.log(1)}}},q=Y,W=Object(F["a"])(q,J,H,!1,null,null,null),X=W.exports,Z={name:"App",data:function(){return{receivedData:[],layers:[],tooltips:[],dates:[],indicator:"PM",time:"",show:!0}},components:{Map:X,Control:V},mounted:function(){var t=this;I().then((function(e){w(e).then((function(r){var a=A(r,"PM"),n=E(a);r.push.apply(r,Object(i["a"])(n));var o=localStorage.getItem("KNC_VIDEOCLIP_INDICATOR");o&&(t.show=!1,t.indicator=o),t.dates=e,t.receivedData=r,t.time=e[0],t.tooltips=j(r,e,t.indicator);var s=M(r,e[0],t.indicator);t.layers=S(s,t.indicator)}))}))},methods:{UpdateMap:function(t){this.time=t;var e=M(this.receivedData,t,this.indicator);this.layers=S(e,this.indicator)},UpdateIndicator:function(t){this.show=!1,this.indicator=t;var e=M(this.receivedData,this.time,this.indicator);this.tooltips=j(this.receivedData,this.dates,t),this.layers=S(e,t)}}},tt=Z,et=(r("034f"),Object(F["a"])(tt,n,o,!1,null,null,null)),rt=et.exports,at=r("1cf8"),nt=(r("4989"),r("f9e3"),r("2b69"),r("4971")),ot=r.n(nt);r("24df");a["default"].component("VueSlider",ot.a),a["default"].config.productionTip=!1,a["default"].use(at["a"]),new a["default"]({render:function(t){return t(rt)}}).$mount("#app")},5830:function(t,e,r){t.exports=r.p+"img/play.7b1e9704.svg"},"66e6":function(t,e,r){t.exports=r.p+"img/wheel.7c642c83.svg"},"85ec":function(t,e,r){},ec55:function(t,e,r){t.exports=r.p+"img/arrow-up.d851613e.svg"},ec7e:function(t,e,r){t.exports=r.p+"img/pause.04460c93.svg"}});
//# sourceMappingURL=app.f912ef66.js.map